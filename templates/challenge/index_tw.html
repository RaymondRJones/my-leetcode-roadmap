{% extends "base_tw.html" %}

{% block title %}28-Day Challenge - Ray's LeetCode Roadmap{% endblock %}

{% block content %}
{% if not enrolled %}
<!-- Hero Section for Non-Enrolled Users -->
<div class="text-center mb-12">
    <div class="w-20 h-20 rounded-2xl bg-warning/20 flex items-center justify-center mx-auto mb-6">
        <svg class="w-10 h-10 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
        </svg>
    </div>
    <h1 class="text-4xl md:text-5xl font-bold text-foreground mb-4">28-Day LeetCode Challenge</h1>
    <p class="text-lg text-foreground-muted max-w-2xl mx-auto mb-6">
        Transform your coding skills in just 28 days. Solve curated problems,
        track your progress, earn achievements, and compete on the leaderboard.
    </p>
</div>

<!-- Features Grid -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
    <div class="card text-center">
        <div class="w-14 h-14 rounded-xl bg-primary/20 flex items-center justify-center mx-auto mb-4">
            <svg class="w-7 h-7 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
            </svg>
        </div>
        <h5 class="text-lg font-semibold text-foreground mb-2">Built-in Code Editor</h5>
        <p class="text-foreground-muted text-sm">Write and test Python code directly in your browser with instant feedback.</p>
    </div>
    <div class="card text-center">
        <div class="w-14 h-14 rounded-xl bg-danger/20 flex items-center justify-center mx-auto mb-4">
            <svg class="w-7 h-7 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"/>
            </svg>
        </div>
        <h5 class="text-lg font-semibold text-foreground mb-2">Streak Tracking</h5>
        <p class="text-foreground-muted text-sm">Build consistency with daily streaks and earn bonus points for maintaining them.</p>
    </div>
    <div class="card text-center">
        <div class="w-14 h-14 rounded-xl bg-success/20 flex items-center justify-center mx-auto mb-4">
            <svg class="w-7 h-7 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
            </svg>
        </div>
        <h5 class="text-lg font-semibold text-foreground mb-2">Achievements & Points</h5>
        <p class="text-foreground-muted text-sm">Unlock achievements, earn points, and climb the leaderboard.</p>
    </div>
</div>

<!-- Points System -->
<div class="card mb-12">
    <h4 class="text-lg font-semibold text-foreground mb-6 flex items-center gap-2">
        <svg class="w-5 h-5 text-warning" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
        </svg>
        Points System
    </h4>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <h6 class="text-sm font-medium text-foreground-muted mb-3">Problem Points</h6>
            <ul class="space-y-2">
                <li class="flex items-center gap-2 text-foreground-muted">
                    <span class="badge-easy">Easy</span>
                    {{ point_values.easy }} points per problem
                </li>
                <li class="flex items-center gap-2 text-foreground-muted">
                    <span class="badge-medium">Medium</span>
                    {{ point_values.medium }} points per problem
                </li>
                <li class="flex items-center gap-2 text-foreground-muted">
                    <span class="badge-hard">Hard</span>
                    {{ point_values.hard }} points per problem
                </li>
            </ul>
        </div>
        <div>
            <h6 class="text-sm font-medium text-foreground-muted mb-3">Streak Bonuses</h6>
            <ul class="space-y-2">
                <li class="flex items-center gap-2 text-foreground-muted">
                    <svg class="w-5 h-5 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
                    </svg>
                    7-day streak: +{{ point_values.streak_7 }} bonus
                </li>
                <li class="flex items-center gap-2 text-foreground-muted">
                    <svg class="w-5 h-5 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
                    </svg>
                    14-day streak: +{{ point_values.streak_14 }} bonus
                </li>
                <li class="flex items-center gap-2 text-foreground-muted">
                    <svg class="w-5 h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                    </svg>
                    28-day completion: +{{ point_values.streak_28 }} bonus
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- CTA -->
<div class="text-center">
    {% if is_authenticated %}
    <button onclick="enrollInChallenge()" class="btn-primary px-8 py-4 text-lg">
        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        Start the Challenge
    </button>
    {% else %}
    <a href="/auth/login" class="btn-primary px-8 py-4 text-lg inline-flex items-center">
        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
        </svg>
        Sign In to Start
    </a>
    {% endif %}
</div>

{% else %}
<!-- Dashboard for Enrolled Users -->
<div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-foreground flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-warning/20 flex items-center justify-center">
            <svg class="w-6 h-6 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
            </svg>
        </div>
        28-Day Challenge
    </h1>
    <a href="/challenge/calendar" class="btn-secondary">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        View Calendar
    </a>
</div>

<!-- Stats Row -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <div class="stat-card">
        <svg class="w-10 h-10 text-danger mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
        </svg>
        <span class="stat-value">{{ challenge_data.current_streak or 0 }}</span>
        <span class="stat-label">Current Streak</span>
    </div>
    <div class="stat-card">
        <svg class="w-10 h-10 text-warning mb-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
        </svg>
        <span class="stat-value">{{ challenge_data.points or 0 }}</span>
        <span class="stat-label">Total Points</span>
    </div>
    <div class="stat-card">
        <svg class="w-10 h-10 text-success mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span class="stat-value">{{ challenge_data.total_problems_solved or 0 }}</span>
        <span class="stat-label">Problems Solved</span>
    </div>
    <div class="stat-card">
        <svg class="w-10 h-10 text-primary mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <span class="stat-value">{{ challenge_data.days_completed|length or 0 }}/28</span>
        <span class="stat-label">Days Completed</span>
    </div>
</div>

<!-- Challenge Rules -->
<div class="card mb-6">
    <h5 class="font-semibold text-foreground mb-3 flex items-center gap-2">
        <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
        </svg>
        Challenge Rules
    </h5>
    <ul class="text-foreground-muted space-y-2">
        <li class="flex items-start gap-2">
            <svg class="w-5 h-5 text-success flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            Solve at least <strong class="text-foreground">1 LeetCode problem per day</strong>
        </li>
        <li class="flex items-start gap-2">
            <svg class="w-5 h-5 text-success flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            Build a <strong class="text-foreground">7-day streak</strong>, then extend to <strong class="text-foreground">28 days</strong>
        </li>
        <li class="flex items-start gap-2">
            <svg class="w-5 h-5 text-success flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            Solve ANY problem you want - not limited to the calendar problems
        </li>
    </ul>
</div>

<!-- Progress Bar -->
<div class="card mb-6">
    <div class="flex justify-between items-center mb-2">
        <h5 class="font-semibold text-foreground">Challenge Progress</h5>
        <span class="text-foreground-muted text-sm">{{ ((challenge_data.days_completed|length or 0) / 28 * 100)|round|int }}% Complete</span>
    </div>
    <div class="h-3 bg-background-secondary rounded-full overflow-hidden">
        <div class="h-full bg-gradient-to-r from-primary to-success rounded-full transition-all duration-500" style="width: {{ ((challenge_data.days_completed|length or 0) / 28 * 100)|round|int }}%"></div>
    </div>
</div>

<!-- Mini Calendar -->
<div class="card mb-6">
    <div class="flex justify-between items-center mb-4">
        <h5 class="font-semibold text-foreground flex items-center gap-2">
            <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            Your 28-Day Calendar
        </h5>
        <a href="/challenge/calendar" class="text-sm text-primary hover:text-primary-hover flex items-center gap-1">
            Full Calendar
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
            </svg>
        </a>
    </div>
    <div class="grid grid-cols-7 gap-2">
        {% for day in range(1, 29) %}
        <a href="/challenge/day/{{ day }}"
           class="aspect-square flex items-center justify-center rounded-lg text-sm font-medium transition-all
                  {% if day in days_completed %}bg-success text-white{% elif day == current_day %}bg-primary text-white ring-2 ring-primary ring-offset-2 ring-offset-background-elevated{% elif day < current_day %}bg-background-secondary text-foreground-muted hover:bg-background-hover{% else %}bg-background-secondary/50 text-foreground-subtle pointer-events-none{% endif %}"
           title="Day {{ day }}{% if day in days_completed %} - Completed{% elif day == current_day %} - Today{% elif day < current_day %} - Available{% else %} - Locked{% endif %}">
            {{ day }}
        </a>
        {% endfor %}
    </div>
    <div class="mt-4 flex items-center justify-center gap-6 text-xs text-foreground-muted">
        <span class="flex items-center gap-1"><span class="w-3 h-3 bg-success rounded"></span> Completed</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 bg-primary rounded"></span> Current</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 bg-background-secondary rounded"></span> Available</span>
        <span class="flex items-center gap-1"><span class="w-3 h-3 bg-background-secondary/50 rounded"></span> Locked</span>
    </div>
</div>

<!-- Activity Heatmap -->
<div class="card mb-6">
    <div class="flex justify-between items-center mb-4">
        <h5 class="font-semibold text-foreground flex items-center gap-2">
            <svg class="w-5 h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
            Activity Tracker
        </h5>
        <div class="flex items-center gap-2 text-xs text-foreground-muted">
            <span>Less</span>
            <div class="flex gap-1">
                <div class="heatmap-0 heatmap-cell"></div>
                <div class="heatmap-1 heatmap-cell"></div>
                <div class="heatmap-2 heatmap-cell"></div>
                <div class="heatmap-3 heatmap-cell"></div>
                <div class="heatmap-4 heatmap-cell"></div>
            </div>
            <span>More</span>
        </div>
    </div>
    <div class="overflow-x-auto pb-2">
        <div id="activityHeatmap" class="grid gap-0.5" style="grid-template-columns: repeat(53, 12px); grid-template-rows: repeat(7, 12px); width: fit-content;"></div>
    </div>
    <div class="mt-3 text-center">
        <small class="text-foreground-muted" id="heatmapSummary"></small>
    </div>
</div>

<!-- Quick Actions -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
    <a href="/challenge/day/{{ [challenge_data.days_completed|length + 1, 28]|min }}" class="card group hover:border-primary transition-colors">
        <div class="flex items-center gap-4">
            <div class="w-14 h-14 rounded-xl bg-primary/20 flex items-center justify-center group-hover:bg-primary/30 transition-colors">
                <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <div>
                <h5 class="font-semibold text-foreground mb-1">Continue Challenge</h5>
                <p class="text-foreground-muted text-sm">Go to Day {{ [challenge_data.days_completed|length + 1, 28]|min }}</p>
            </div>
        </div>
    </a>
    <a href="/challenge/leaderboard" class="card group hover:border-warning transition-colors">
        <div class="flex items-center gap-4">
            <div class="w-14 h-14 rounded-xl bg-warning/20 flex items-center justify-center group-hover:bg-warning/30 transition-colors">
                <svg class="w-8 h-8 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
            </div>
            <div>
                <h5 class="font-semibold text-foreground mb-1 flex items-center gap-2">
                    Leaderboard
                    <span class="badge-secondary text-xs">Coming Soon</span>
                </h5>
                <p class="text-foreground-muted text-sm">See how you rank against others</p>
            </div>
        </div>
    </a>
</div>

<!-- Achievements -->
<div class="card">
    <h5 class="font-semibold text-foreground mb-6 flex items-center gap-2">
        <svg class="w-5 h-5 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
        </svg>
        Achievements
    </h5>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        {% for achievement_id, achievement in achievements_config.items() %}
        <div class="flex items-center gap-3 p-4 rounded-xl {% if achievement_id in (challenge_data.achievements or []) %}bg-success/10 border border-success/30{% else %}bg-background-secondary{% endif %}">
            <div class="w-10 h-10 rounded-lg {% if achievement_id in (challenge_data.achievements or []) %}bg-success/20{% else %}bg-background-elevated{% endif %} flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 {% if achievement_id in (challenge_data.achievements or []) %}text-success{% else %}text-foreground-subtle{% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    {% if achievement.icon == 'emoji_events' %}
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                    {% elif achievement.icon == 'local_fire_department' %}
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
                    {% elif achievement.icon == 'military_tech' %}
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                    {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    {% endif %}
                </svg>
            </div>
            <div>
                <p class="font-medium {% if achievement_id in (challenge_data.achievements or []) %}text-foreground{% else %}text-foreground-muted{% endif %}">{{ achievement.name }}</p>
                <p class="text-xs text-foreground-subtle">{{ achievement.description }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<script>
async function enrollInChallenge() {
    try {
        const response = await fetch('/api/challenge/enroll', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });

        const data = await response.json();

        if (data.status === 'success') {
            window.location.reload();
        } else {
            alert('Failed to enroll: ' + (data.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error enrolling:', error);
        alert('Failed to enroll. Please try again.');
    }
}

{% if enrolled and heatmap_data %}
// Render activity heatmap
(function() {
    const heatmapData = {{ heatmap_data | tojson }};
    const container = document.getElementById('activityHeatmap');

    if (!container || !heatmapData.length) return;

    let totalProblems = 0;
    let activeDays = 0;

    const dateMap = {};
    heatmapData.forEach(day => {
        dateMap[day.date] = day;
        totalProblems += day.count;
        if (day.count > 0) activeDays++;
    });

    const today = new Date();
    const gridStartDate = new Date(today);
    gridStartDate.setDate(gridStartDate.getDate() - 364);
    while (gridStartDate.getDay() !== 0) {
        gridStartDate.setDate(gridStartDate.getDate() - 1);
    }

    for (let week = 0; week < 53; week++) {
        for (let dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++) {
            const cellDate = new Date(gridStartDate);
            cellDate.setDate(gridStartDate.getDate() + (week * 7) + dayOfWeek);

            const dateStr = cellDate.toISOString().split('T')[0];
            const dayData = dateMap[dateStr] || { count: 0 };

            const cell = document.createElement('div');
            cell.className = 'heatmap-cell heatmap-' + Math.min(dayData.count, 4);
            cell.setAttribute('data-count', Math.min(dayData.count, 4));
            cell.setAttribute('data-date', dateStr);

            const options = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
            const formattedDate = cellDate.toLocaleDateString('en-US', options);
            cell.title = `${formattedDate}: ${dayData.count} problem${dayData.count !== 1 ? 's' : ''}`;

            container.appendChild(cell);
        }
    }

    const summaryEl = document.getElementById('heatmapSummary');
    if (summaryEl) {
        summaryEl.textContent = `${totalProblems} problem${totalProblems !== 1 ? 's' : ''} solved across ${activeDays} day${activeDays !== 1 ? 's' : ''} in the past year`;
    }
})();
{% endif %}
</script>
{% endblock %}
